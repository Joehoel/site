---
import { MarkdocRenderer } from "@/components/markdoc-renderer";
import { getAllPages, getPage } from "@/data/post";
import PageLayout from "@/layouts/base.astro";
import type { GetStaticPaths } from "astro";

export const getStaticPaths = (async () => {
	const pages = await getAllPages();
	return pages.map((page) => ({
		params: { slug: page.slug },
		props: { slug: page.slug },
	}));
}) satisfies GetStaticPaths;

const { slug } = Astro.props;
const page = await getPage(slug);

if (!page) {
	return Astro.redirect("/404");
}
---

<PageLayout
	meta={{
		title: page.title,
		ogImage: page.ogImage ?? undefined,
		articleDate: new Date(page.publishDate).toISOString(),
	}}
>
	<h1 class="title mb-6">{page.title}</h1>
	<div
		class="prose prose-sm prose-joel mt-12 prose-headings:font-semibold prose-headings:text-accent-2 prose-headings:before:absolute prose-headings:before:-ms-4 prose-headings:before:text-accent sm:prose-headings:before:content-['#'] sm:prose-th:before:content-none"
	>
		<MarkdocRenderer client:load content={page.renderedContent} />
	</div>
</PageLayout>
